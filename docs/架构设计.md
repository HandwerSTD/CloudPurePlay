# 架构设计文档

## 🏗 云净听的标准三层架构划分

### 📦 1. `common` 层（底层基座）

| 子模块           | 职责                             |
|---------------| ------------------------------ |
| `store/`      | 全局状态管理（如播放状态、登录信息、主题偏好）        |
| `entity/`     | 所有实体类定义（Song、Playlist、Lyric 等） |
| `CloudAPI/`   | API 请求工具封装（统一异常处理、请求签名等）       |
| `utils/`      | 通用工具方法（格式化工具、歌词解析器、时间轴对齐等）     |
| `components/` | 可复用 UI 组件（播放器控制条、歌词面板、加载动画等）   |

✅ 作用：确保业务层不会重复造轮子，任何模块都可以用它。

---

### 🎯 2. `feature` 层（核心功能）

| 子模块        | 说明                        |
|------------| ------------------------- |
| `player/`  | 播放器模块（主页面、播放控制、歌词展示、封面动效） |
| `explore/` | 浏览页（比如推荐歌曲、搜索结果展示）        |
| `setting/` | 设置页（主题切换、播放模式设置等）         |
| `card/`    | 桌面服务卡片能力（小控件播放）           |

✅ 每个 feature 模块是“高内聚、低耦合”的单元，可以独立测试、迭代、维护。

---

### 📱 3. `product` 层（设备形态组合）

| 产品形态        | 模块组合                      |
|-------------| ------------------------- |
| `default/`  | 播放器主界面 + 浏览页 + 设置页 + 卡片服务 |
| `wearable/` | 仅提供播放控制界面 + 卡片控制          |
| `car/`      | 大字体、语音控制入口 + 最简播放页        |

✅ 每个 product 是独立的部署单元，负责组织 UI 构成和服务能力组合。

## common 层状态管理设计 （base/store）

### 🗂 1. 状态分类（按照作用域）

| 状态模块           | 用途     | 示例                 |
| -------------- | ------ | ------------------ |
| `playerStore`  | 当前播放信息 | 歌曲ID、播放URL、播放状态、进度 |
| `userStore`    | 登录信息   | Token、用户昵称、是否VIP   |
| `appStore`     | 应用级状态  | 当前主题、网络状态、设备形态     |
| `settingStore` | 用户设置   | 播放模式、是否自动播放、歌词样式   |

---

### 🧩 2. 状态设计原则

* **响应式**：页面监听状态变化后自动更新（ArkTS 的 `@State`, `@Observed`）
* **模块化**：每个 Store 文件独立管理各自数据、方法
* **可持久化**：支持本地存储，App 重启后能自动恢复
* **事件驱动**：状态变更可以广播事件，供多个模块响应
